name: Run Reddit Crawler

# 可以手动触发，也可以定时触发
on:
  schedule:
    # 每4小时执行一次（UTC时间 0点、4点、8点、12点、16点、20点）
    - cron: "0 */4 * * *"
  workflow_dispatch:  # 允许手动运行

jobs:
  crawl:
    runs-on: ubuntu-latest

    steps:
      # 1. 获取仓库代码
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. 设置 Node.js 环境
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '22'

      # 3. 安装项目依赖
      - name: Install npm dependencies
        run: npm install

      # 4. 安装 Playwright 浏览器
      - name: Install Playwright browsers
        run: npx playwright install

      # 5. 安装 Playwright Linux 系统依赖
      - name: Install Playwright Linux dependencies
        run: npx playwright install-deps

      # 6. 测试网络（可选，确保可以访问 Reddit）
      - name: Test Reddit connectivity
        run: curl -I https://www.reddit.com/r/Supabase/new/ || echo "Cannot reach Reddit, check network"

      # 7. 运行爬虫
      - name: Run Reddit crawler
        run: |
          node 3.reddit.mjs
        env:
          REDDIT_KEY: ${{ secrets.REDDIT_KEY }} # 如果你的脚本需要 API Key
